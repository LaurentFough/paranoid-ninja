#!/bin/sh

NFT=$(which nft)
SYSTEMD_S="/usr/lib/systemd/scripts"
readonly prog_name="$0"

RAND=false
MAC=false
STOP=false

DIR="$(pwd)"
FUNCS="$DIR/src/functions"
source ${FUNCS}

######################################################
# Stop

stopParanoid() {
  if [[ $firewall == "nftables" ]] ; then
    $NFT flush ruleset
  elif [[ $firewall == "iptables" ]] ; then
    echo -n
  else
    echo "$firewall is no valid"
    exit 1
  fi
}

######################################################
# Command options

if [ "$#" -eq 0 ]; then
    printf "%s\\n" "$prog_name: Argument required"
    exit 1
fi

while [ "$#" -gt 0 ] ; do
  case "$1" in
    -r | --randomize)
      RAND=true
      shift
      ;;
    -m | --mac)
      MAC=true
      shift
      ;;
    -c | --config)
      CONF="$2"
      checkConfigFile "$2"
      shift
      shift
      ;;
    -s | --stop)
      STOP=true
      shift
      ;;
    *)
      printf "%s\\n" "$prog_name: Invalid option '$1'"
      exit 1
      ;;
  esac
done

if [[ $MAC == true ]] ; then
  . $SYSTEMD_S/randomize.sh -c $CONF
fi

if [[ $RAND == true ]] && [[ $CONF ]] ; then
  . $SYSTEMD_S/randomize.sh -c $CONF
fi

if [[ $STOP == true ]] && [[ $CONF ]] ; then
  stopParanoid
fi
